TCP over UDP

На базе протокола UDP разработать собственный потоковый протокол с контролем доставки данных и с упорядочением фрагментов потока. В качестве образца взять TCP.
Реализовать собственные версии функций listen, accept, connect, send, recv и close. При использовании ОО-языка желательно оформить в виде классов по принципу разделения ответственности.
На серверной стороне необходимо использовать один UDP-сокет, не допускается открывать новый UDP-сокет для каждого клиента.
Для обеспечения функционирования протокола допускается использование фиксированного кол-ва фоновых тредов (достаточно одного или двух) на каждой стороне.
Отправляемые и получаемые данные должны буферизоваться, отправляемые данные сегментироваться по аналогии с "реальным" TCP.
Работа всех реализованных функций должна быть аналогична работе с сокетом в блокирующемся режиме.

Для обеспечения своевременной блокировки/разблокировки желательно по возможности использовать высокоуровневые потокобезопасные способы, такие как BlockingQueue в Java, но также допускается аккуратное использование примитивов, таких как мутексы и семафоры.
Закрытие соединения должно быть безопасным, то есть возвращаться успешно только когда данные были успешно доставлены.
Необходимо реализовать выдачу соответствующих ошибок об обрыве соединения по таймауту.

Все используемые ресурсы ОС должны быть корректно освобождены, как только они больше не нужны.
Реализация динамической подстройки параметров, таких как размер сегмента и размер окна, не требуется.

Баллов за задачу: 3.
